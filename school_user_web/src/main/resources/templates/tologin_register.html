<!DOCTYPE html>
<html lang="en">
 <head> 
  <meta charset="UTF-8" /> 
  <meta http-equiv="X-UA-Compatible" content="IE=edge" /> 
  <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ --> 
  <meta name="description" content="" /> 
  <meta name="author" content="" /> 
  <link rel="icon" href="./img/asset-favicon.ico" /> 
  <title>社交-登录注册</title> 
  <!-- 页面 css js --> 
  <!-- <script type="text/javascript" src="../../plugins/sui/sui.min.js" charset="UTF-8"></script> --> 
  <link rel="stylesheet" type="text/css" href="./plugins/normalize-css/normalize.css" /> 
  <link rel="stylesheet" type="text/css" href="./plugins/yui/cssgrids-min.css" /> 
  <link rel="stylesheet" type="text/css" href="./plugins/sui/sui.min.css" /> 
  <link rel="stylesheet" type="text/css" href="./plugins/sui/sui-append.min.css" /> 
  <link rel="stylesheet" type="text/css" href="./plugins/font-awesome/css/font-awesome.min.css" /> 
  <link rel="stylesheet" type="text/css" href="./css/widget-base.css" /> 
  <link rel="stylesheet" type="text/css" href="./css/widget-head-foot.css" /> 
  <link rel="stylesheet" type="text/css" href="./css/page-sj-person-loginsign.css" />
  <script src="./js/vuejs-2.5.16.js"></script>
  <script src="./js/axios-0.18.0.js"></script>
  <script src="./js/jquery-3.4.1.js"></script>
  <link rel="stylesheet" type="text/css" href="./js/elementui/elementui.css">
  <script src="./js/elementui/elementui.js"></script>
  <style>
   [v-cloak]{
    display: none;
   }
  </style>
 </head> 
 <body> 
  <!--头部导航--> 
  <header class="head-login"> 
   <div class="wrapper"> 
    <div class="sui-navbar"> 
     <div class="navbar-inner"> 
      <a href="./index-login.html" class="sui-brand"> <img src="./img/asset-logo-black.png" alt="社交" /> </a> 
      <span class="login-text">| 登录注册</span> 
     </div> 
    </div> 
   </div>
  </header>

  <div class="wrapper loginsign" >
   <!--注册-->
   <div class="item signup" id="registerApp">
    <div class="form"> 
     <h3 class="loginsign-title">注册新账号</h3> 
     <form class="sui-form"> 
      <div class="control-group"> 
       <label for="inputname" class="control-label">名字</label> 
       <div class="controls"> 
        <input type="text" id="register_name" v-model="user.nickname" placeholder="真实姓名或常用昵称" class="input-xlarge" />
       </div> 
      </div> 
      <div class="different"> 
       <div class="radio-content"> 
        <div id="a1" class="phone"> 
         <div class="control-group number"> 
          <input type="text" placeholder="请输入邮箱" class="input-xlarge" v-model.trim ="user.mobile"/>
         </div> 
         <div class="control-group code"> 
          <div class="input-append"> 
           <input v-model.trim="verifyCode" type="text" placeholder="邮箱验证码" class="span2 input-large msg-input" />
           <button type="button" v-if="show" class="sui-btn msg-btn" @click="getCode()">获取验证码</button>
           <button type="button" v-if="!show" class="sui-btn msg-btn">{{count}} s</button>
          </div> 
         </div> 
         <div class="control-group"> 
          <label for="inputpassword" class="control-label" >密码</label>
          <div class="controls"> 
           <input type="password" style="height: 32px" v-model.trim="user.password" placeholder="请输入密码" class="input-xlarge" />
          <br/>
           <span v-text="error" style="color: red;font-size: medium"></span>
          </div> 
         </div> 
        </div> 
       </div> 
      </div> 
      <div class="control-group btn-signup"> 
       <label class="control-label"></label> 
       <div class="controls"> 
        <label> <input type="checkbox" v-model="checkflag" style="margin-right: 0px;padding-right: 0px"/>
         <span class="type-text" style="font-size:12px;margin:0px;padding: 0px">同意协议并接受
         </span >
        </label>
        《<span style="color: green;margin:0px;padding: 0px" onclick="alert('在该平台不允许做任何违法国家法律的事情，否则后果自负')">服务条款</span>》
        <button type="button" class="sui-btn btn-danger btn-yes" @click="register()">注 册</button>
       </div> 
      </div> 
     </form> 
    </div> 
   </div>
   <!--注册-->
   <!--登录和修改密码-->
   <div class="item" id="loginApp" >
    <!--登陆-->
    <div class="form" v-show="registerLoginFlag">
     <h3 class="loginsign-title">用户登录</h3> 
     <form class="sui-form login-form"> 
      <div class="control-group"> 
       <label for="inputname" class="control-label" >邮箱：</label>
       <div class="controls"> 
        <input type="text" height="32px" id="inputname" v-model.trim="user.mobile" placeholder="请输入邮箱" class="input-xlarge" data-rules="required" />
       </div> 
      </div>

      <div class="control-group"> 
       <label for="inputpassword" class="control-label" >密码：</label>
       <div class="controls">
        <input type="password" style="height: 32px"  id="inputpassword" v-model.trim="user.password" placeholder="输入登录密码" class="input-xlarge" data-rules="required"/>
         <br/>
        <span v-text="result.message" style="color: red;font-size: medium"></span>
       </div>

      </div>


      <div class="controls">

       <label>
          <input type="checkbox" name="rememberme" v-model="rememberme"/>
          <span class="type-text" style="font-size:12px;">记住登录状态</span> &nbsp;&nbsp;
       </label>
       <label>
        <a class="type-text" style="font-size:12px;margin:0px;padding: 0px;color: green" @click="registerLoginComeBack()">忘记密码?
        </a >
       </label>

       <button type="button" class="sui-btn btn-danger btn-yes" @click="login">登 录</button>
      </div> 
      <div class="other-methods"> 
      </div> 
     </form> 
    </div>
    <!--登陆-->
    <!--修改密码-->
    <div class="form" v-show="!registerLoginFlag">
     <h3 class="loginsign-title">修改密码</h3>
     <form class="sui-form">
      <!--<div class="control-group">-->
       <!--<label for="inputname" class="control-label">名字</label>-->
       <!--<div class="controls">-->
        <!--<input type="text" id="register_name3" v-model="user.nickname" placeholder="真实姓名或常用昵称" class="input-xlarge" />-->
       <!--</div>-->
      <!--</div>-->
      <div class="different">
       <div class="radio-content">
        <div id="a3" class="phone">
         <div class="control-group number">
          <label for="inputname" class="control-label">邮箱</label>
          <input type="text" placeholder="请输入邮箱" class="input-xlarge" v-model.trim ="user.mobile"/>
         </div>
         <div class="control-group code">
          <div class="input-append">
           <input v-model.trim="verifyCode" type="text" placeholder="邮箱验证码" class="span2 input-large msg-input" />
           <button type="button" v-if="show" class="sui-btn msg-btn" @click="getCode()">获取验证码</button>
           <button type="button" v-if="!show" class="sui-btn msg-btn">{{count}} s</button>
          </div>
         </div>
         <div class="control-group">
          <label for="inputpassword" class="control-label" >密码</label>
          <div class="controls">
           <input type="password" style="height: 32px" v-model.trim="user.password" placeholder="请输入密码" class="input-xlarge" />
           <br/>
           <span v-text="result.message" style="color: red;font-size: medium"></span>
          </div>
         </div>
        </div>
       </div>
      </div>
      <div class="control-group btn-signup">
       <label class="control-label"></label>
       <div class="controls">
        <label>
         &nbsp;&nbsp;
          <a class="type-text" style="font-size:12px;margin:0px;padding: 0px;color: green" @click="registerLoginComeBack()">返回登陆?
          </a >
        </label>
        &nbsp;&nbsp;
        <button type="button" class="sui-btn btn-danger btn-yes" @click="updatePass()">修改</button>
       </div>
      </div>
     </form>
    </div>
    <!--修改密码-->
   </div>
   <!--登录和修改密码-->

  </div>

  <script type="text/javascript">
   <!--登录vue-->
    var userlogin = new Vue({
            el:"#loginApp",
            data:{
                user: {},
                result:{
                    message:""
                },
                rememberme:false,
                registerLoginFlag:true,  //true表示显示登陆 false表示显示修改密码
                show:true,   //验证码倒计时，默认是显示发送按钮，点击后显示倒计时，倒计时结束后，又变成发送按钮
                count: '',
                timer: null,
                verifyCode:"", //验证码


            },
        methods:{

            login: function () {
                this.result.message="";
                var regEmail = /^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;
                if(this.user.mobile==null||this.user.mobile==""){
                    this.result.message="邮箱不能为空";
                }else if(!regEmail.test(this.user.mobile)){
                    this.result.message="邮箱格式不正确";
                }else if(this.user.password==null||this.user.password==""){
                    this.result.message="密码不能为空";
                }else{
                    var url = "http://localhost:9001/user/login";
                    var _this = this;
                    //post必须用这种方式
                    var params = new URLSearchParams()
                    params.append('mobile', this.user.mobile)
                    params.append('password',this.user.password)
                    //post必须用这种方式
                    axios.post(url, params).then(function (response) {
                        _this.result = response.data;
                        window.localStorage.setItem("nickName_school",_this.result.data.name);
                        window.localStorage.setItem("mobile_school",_this.user.mobile);
                        window.localStorage.setItem("token_school",_this.result.data.token);
                        if (_this.rememberme==true){  //如果为true下次登录就直接显示了
                            window.localStorage.setItem("userpass_school",_this.user.password);
                        } else {  //如果为false，就将密码删除
                            window.localStorage.removeItem("userpass_school");
                        }
                    }).catch(function (err) {
                        console.log("网络错误");
                    });
                }

            },  //login方法
            loadInit: function(){
                var userpass_school = window.localStorage.getItem("userpass_school");
                if (userpass_school!=null){
                   this.user.mobile = window.localStorage.getItem("mobile_school");
                   this.user.password = userpass_school;
                   this.rememberme=true;
                }
            },
            registerLoginComeBack:function () {
                this.registerLoginFlag = !this.registerLoginFlag;
            }
        },  //methods
        created(){
            this.loadInit();
        }
    });


  //  注册vue
   var userRegister = new Vue({
       el:"#registerApp",
       data:{
           user: {},  //用户
           verifyCode:"", //验证码
           result:{}, //服务器返回结果
           checkflag:true,  //是否同意协议，默认同意
           show:true,   //验证码倒计时，默认是显示发送按钮，点击后显示倒计时，倒计时结束后，又变成发送按钮
           count: '',
           timer: null,
           error:""
       },
       methods:{
           getCode:function () {
               this.error="";
               //邮箱正则表达式
               var regEmail = /^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;
               if(this.user.mobile==null||this.user.mobile==""){
                  this.error="邮箱不能为空";
               }else if(!regEmail.test(this.user.mobile)){
                   this.error="邮箱格式不正确"
               }else{
                   var url = "http://localhost:9001/user/sendsms/"+this.user.mobile;
                   var _this = this;

                   axios.post(url).then(function (response) {
                       var TIME_COUNT = 30;
                       _this.show = false;
                       console.log(_this.timer);  //null
                       if (!_this.timer) {  //非空
                           _this.count = TIME_COUNT;

                           _this.timer=setInterval(() =>{
                               if (_this.count > 0 && _this.count <= TIME_COUNT) {
                               _this.count--;
                           } else{
                               _this.show = true;
                               clearInterval(_this.timer);
                               _this.timer = null;
                           }
                       },1000);

                       }
                   }).catch(function (err) {
                       console.log("网络错误");
                   });
               }  //else

           },  //getcode
           //注册方法
           register:function () {
               this.error="";
               var regEmail = /^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;
               if(this.user.nickname==null||this.user.nickname==""){
                   this.error="名字不能为空";
               }else if(this.user.mobile==null||this.user.mobile==""){
                   this.error="邮箱不能为空";
               }else if(!regEmail.test(this.user.mobile)){
                   this.error="邮箱格式不正确";
               }else if(this.verifyCode==null||this.verifyCode==""){
                   this.error="验证码不能为空";
               }else if(this.user.password==null||this.user.password==""){
                   this.error="密码不能为空";
               }else if(this.checkflag == false){
                   this.error="你必须同意服务条款才能注册";
               }else{
                   var url = "http://localhost:9001/user/register/"+this.verifyCode;
                   var _this = this;
                   //json请求用默认方式
                   axios.post(url, _this.user
                   ).then(function (response) {
                       _this.result = response.data;
                       _this.error = _this.result.message;
                   }).catch(function (err) {
                       console.log("网络错误");
                   });
               }



           }
       }
   });

  </script>


  <!--中间部分-->

  <!--尾部-->
  <div id="footer">

  </div>
  <script>
      $('#footer').load('footer.html');
  </script>
  <!--尾部-->

 </body>
</html>